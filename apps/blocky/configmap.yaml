apiVersion: v1
kind: ConfigMap
metadata:
  name: blocky-config
data:
  config.yml: |
    upstreams:
      groups:
        default:
          - 192.168.2.1
          - 1.1.1.1
          - 8.8.8.8

    blocking:
      blockType: nxDomain
      denylists:
        ads:
          - https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
          - https://raw.githubusercontent.com/kboghdady/youTube_ads_4_pi-hole/refs/heads/master/youtubelist.txt
          - https://perflyst.github.io/PiHoleBlocklist/SmartTV.txt
      allowlists:
        ads:
          - https://raw.githubusercontent.com/anudeepND/whitelist/master/domains/whitelist.txt
          - https://raw.githubusercontent.com/m0zgen/dns-hole/master/regex/common-wl.txt
      clientGroupsBlock:
        default:
          - ads

    caching:
      cacheTimeNegative: 1m

    filtering:
      queryTypes:
        - AAAA

    customDNS:
      customTTL: 1h
      mapping:
        homelab: 192.168.2.18

    clientLookup:
      upstream: 192.168.2.1

    ports:
      dns: 53
      http: 4000

    bootstrapDns: 1.1.1.1

    prometheus:
      enable: true
      path: /metrics

    redis:
      address: redis:6379

    queryLog:
      type: postgresql
      logRetentionDays: 30
      target: postgres://cnpg-pooler-rw.cnpg-cluster.svc:5432/blockydb
